<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ê¸€ ë³€í™˜ê¸°</title>
    <style>
      /* âœ¨ ë¦¬ë””ë°”íƒ• í°íŠ¸ (Toast2 ìŠ¤íƒ€ì¼) */
      @font-face {
        font-family: "Ridibatang";
        src: url("https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_twelve@1.0/RIDIBatang.woff")
          format("woff");
        font-weight: normal;
        font-display: swap;
      }

      :root {
        --bg-color: #fcfcfc;
        --text-color: #333;
        --header-bg: #fff;
        --border-color: #ddd;
        --input-bg: #fff;
        --accent-color: #dcb085; /* ë¹µ ìƒ‰ìƒ */
        --btn-bg: #f0f0f0;
        --btn-hover: #e0e0e0;
        --shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        --modal-bg: rgba(0, 0, 0, 0.4);
      }

      body.dark {
        --bg-color: #1a1a1a;
        --text-color: #e0e0e0;
        --header-bg: #222;
        --border-color: #444;
        --input-bg: #2a2a2a;
        --accent-color: #a68b6c;
        --btn-bg: #333;
        --btn-hover: #444;
        --shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        --modal-bg: rgba(0, 0, 0, 0.7);
      }

      * {
        box-sizing: border-box;
      }

      body {
        font-family: "Ridibatang", serif;
        margin: 0;
        padding: 0;
        background-color: var(--bg-color);
        color: var(--text-color);
        height: 100vh;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        transition:
          background 0.3s,
          color 0.3s;
      }

      /* í—¤ë” */
      header {
        height: 60px;
        background: var(--header-bg);
        border-bottom: 1px solid var(--border-color);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 20px;
        flex-shrink: 0;
        z-index: 10;
      }

      h1 {
        font-size: 1.2rem;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .header-controls {
        display: flex;
        gap: 8px;
      }

      button {
        background: var(--btn-bg);
        border: 1px solid var(--border-color);
        color: var(--text-color);
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-family: "Ridibatang", serif;
        font-size: 0.9rem;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
        white-space: nowrap;
      }

      button:hover {
        background: var(--btn-hover);
      }

      /* ë¹µ ì•„ì´ë´í‹°í‹° ë²„íŠ¼ */
      #breadBtn {
        font-size: 1.2rem;
        padding: 4px 8px;
        background: transparent;
        border: none;
      }
      #breadBtn:hover {
        transform: scale(1.1);
        background: transparent;
      }

      /* ë©”ì¸ ë ˆì´ì•„ì›ƒ */
      main {
        flex: 1;
        display: flex;
        padding: 10px;
        gap: 10px;
        overflow: hidden;
      }

      .panel {
        flex: 1;
        display: flex;
        flex-direction: column;
        background: var(--header-bg);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        overflow: hidden;
        box-shadow: var(--shadow);
        position: relative;
      }

      .panel-header {
        padding: 10px 15px;
        background: var(--btn-bg);
        border-bottom: 1px solid var(--border-color);
        font-size: 0.9rem;
        font-weight: bold;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .panel-content {
        flex: 1;
        position: relative;
      }

      textarea {
        width: 100%;
        height: 100%;
        border: none;
        resize: none;
        padding: 15px;
        font-family: "Ridibatang", serif;
        font-size: 1.05rem;
        line-height: 1.6;
        background: var(--input-bg);
        color: var(--text-color);
        outline: none;
      }

      textarea::-webkit-scrollbar {
        width: 8px;
      }
      textarea::-webkit-scrollbar-track {
        background: transparent;
      }
      textarea::-webkit-scrollbar-thumb {
        background: var(--border-color);
        border-radius: 4px;
      }

      /* ëª¨ë°”ì¼ ëŒ€ì‘ */
      @media (max-width: 768px) {
        main {
          flex-direction: column;
        }
        header {
          padding: 0 15px;
        }
        .header-controls button span {
          display: none;
        }
      }

      /* ì„¤ì • ëª¨ë‹¬ */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: var(--modal-bg);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 100;
        opacity: 0;
        transition: opacity 0.2s;
      }
      .modal-overlay.open {
        display: flex;
        opacity: 1;
      }

      .modal-window {
        background: var(--header-bg);
        width: 90%;
        max-width: 400px;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        display: flex;
        flex-direction: column;
        max-height: 80vh;
        overflow: hidden;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid var(--border-color);
      }

      .rule-list {
        flex: 1;
        overflow-y: auto;
        margin-bottom: 15px;
        padding-right: 5px;
      }

      .rule-item {
        display: flex;
        gap: 8px;
        margin-bottom: 8px;
        align-items: center;
      }

      .rule-item input {
        flex: 1;
        padding: 8px;
        border: 1px solid var(--border-color);
        background: var(--input-bg);
        color: var(--text-color);
        border-radius: 4px;
        font-family: "Ridibatang", serif;
        min-width: 0;
      }

      .fixed-rule {
        padding: 8px;
        background: var(--btn-bg);
        border-radius: 4px;
        font-size: 0.9rem;
        color: #888;
        margin-bottom: 8px;
        display: flex;
        justify-content: space-between;
      }

      .input-group {
        display: flex;
        gap: 5px;
        width: 100%;
      }

      .input-group input {
        flex: 1;
        min-width: 0;
        padding: 8px;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        font-family: "Ridibatang";
        background: var(--input-bg);
        color: var(--text-color);
      }

      .quick-actions {
        display: flex;
        justify-content: flex-end;
        gap: 5px;
        margin-bottom: 10px;
        margin-top: 5px;
      }
      .quick-btn {
        font-size: 0.75rem;
        padding: 4px 8px;
        background: var(--bg-color);
        border: 1px solid var(--accent-color);
        color: var(--text-color);
      }

      #addRuleBtn {
        width: 100%;
        background: var(--accent-color);
        color: #fff;
        border: none;
        padding: 10px;
      }

      /* í† ìŠ¤íŠ¸ íŒì—… */
      #toast {
        position: fixed;
        bottom: 30px;
        left: 50%;
        transform: translate(-50%, 20px);
        background: rgba(50, 50, 50, 0.9);
        color: white;
        padding: 10px 20px;
        border-radius: 30px;
        font-size: 0.9rem;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s;
        z-index: 200;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        display: flex;
        align-items: center;
        gap: 8px;
        width: max-content;
        max-width: 90%;
      }
      #toast.show {
        transform: translate(-50%, 0);
        opacity: 1;
        visibility: visible;
      }
    </style>
  </head>
  <body>
    <!-- í—¤ë” -->
    <header>
      <h1>
        <button id="breadBtn" title="ToastOut í™ˆí˜ì´ì§€ë¡œ ì´ë™">ğŸ</button>
        <span>ê¸€ ë³€í™˜ê¸°</span>
      </h1>
      <div class="header-controls">
        <button id="settingBtn" title="í‚¤ì›Œë“œ ì„¤ì •">
          âš™ï¸ <span>ì„¤ì •</span>
        </button>
        <button id="toggleDarkBtn" title="ë‹¤í¬ ëª¨ë“œ">ğŸŒ—</button>
      </div>
    </header>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main>
      <!-- ì…ë ¥ íŒ¨ë„ -->
      <div class="panel">
        <div class="panel-header">
          <span>ì…ë ¥ (Input)</span>
          <div class="header-controls" style="gap: 4px">
            <button
              id="spellBtn"
              title="ë§ì¶¤ë²• ê²€ì‚¬"
              style="color: var(--text-color)"
            >
              ğŸ” ë§ì¶¤ë²•
            </button>
            <button id="copyInputBtn" title="ì…ë ¥ ë‚´ìš© ë³µì‚¬">ğŸ“‘ ë³µì‚¬</button>
            <button id="clearBtn" title="ì§€ìš°ê¸°" style="color: #ff6b6b">
              ğŸ—‘ï¸
            </button>
          </div>
        </div>
        <div class="panel-content">
          <textarea
            id="inputText"
            placeholder="ì—¬ê¸°ì— ê¸€ì„ ì‘ì„±í•˜ì„¸ìš”.&#13;&#10;ìœ ì €, í ì‹œ, í ì†Œ â†’ {{user}}&#13;&#10;ìºë¦­í„°, í ë‚¨, í ë…€ â†’ {{char}}&#13;&#10;ìë™ìœ¼ë¡œ ë³€í™˜ë©ë‹ˆë‹¤."
          ></textarea>
        </div>
      </div>

      <!-- ì¶œë ¥ íŒ¨ë„ -->
      <div class="panel">
        <div class="panel-header">
          <span>ê²°ê³¼ (Output)</span>
          <button id="copyOutputBtn" title="ê²°ê³¼ ë³µì‚¬">âœ¨ ë³µì‚¬</button>
        </div>
        <div class="panel-content">
          <textarea
            id="outputText"
            readonly
            placeholder="ë³€í™˜ëœ í…ìŠ¤íŠ¸ê°€ ì‹¤ì‹œê°„ìœ¼ë¡œ ë‚˜íƒ€ë‚©ë‹ˆë‹¤."
          ></textarea>
        </div>
      </div>
    </main>

    <!-- ì„¤ì • ëª¨ë‹¬ -->
    <div class="modal-overlay" id="settingModal">
      <div class="modal-window">
        <div class="modal-header">
          <h3 style="margin: 0">ë‹¨ì–´ ë³€í™˜ ì„¤ì •</h3>
          <button
            id="closeModal"
            style="border: none; background: transparent; font-size: 1.2rem"
          >
            âœ•
          </button>
        </div>

        <div class="rule-list">
          <div class="fixed-rule">
            <span>ìœ ì €, í ì‹œ, í ì†Œ</span>
            <strong>â†’ {{user}}</strong>
          </div>
          <div class="fixed-rule">
            <span>ìºë¦­í„°, í ë‚¨, í ë…€</span>
            <strong>â†’ {{char}}</strong>
          </div>
          <hr
            style="
              border: 0;
              border-top: 1px solid var(--border-color);
              margin: 15px 0;
            "
          />
          <div id="customRuleContainer">
            <!-- ì»¤ìŠ¤í…€ ë£°ì´ ì—¬ê¸°ì— ì¶”ê°€ë¨ -->
          </div>
        </div>

        <!-- ìƒˆ ê·œì¹™ ì¶”ê°€ ì˜ì—­ -->
        <div style="display: flex; flex-direction: column; width: 100%">
          <div class="input-group">
            <input type="text" id="newKey" placeholder="ë‹¨ì–´ (ì˜ˆ: ê²€)" />
            <input type="text" id="newVal" placeholder="ê²°ê³¼" />
          </div>
          <div class="quick-actions">
            <button class="quick-btn" onclick="fillVal('{{user}}')">
              + {{user}}
            </button>
            <button class="quick-btn" onclick="fillVal('{{char}}')">
              + {{char}}
            </button>
          </div>
          <button id="addRuleBtn">+ ê·œì¹™ ì¶”ê°€</button>
        </div>
      </div>
    </div>

    <!-- í† ìŠ¤íŠ¸ ë©”ì‹œì§€ -->
    <div id="toast">âœ… í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.</div>

    <script>
      // DOM ìš”ì†Œ
      const inputText = document.getElementById("inputText");
      const outputText = document.getElementById("outputText");
      const settingBtn = document.getElementById("settingBtn");
      const settingModal = document.getElementById("settingModal");
      const closeModal = document.getElementById("closeModal");
      const customRuleContainer = document.getElementById(
        "customRuleContainer",
      );
      const newKey = document.getElementById("newKey");
      const newVal = document.getElementById("newVal");
      const toast = document.getElementById("toast");
      const spellBtn = document.getElementById("spellBtn");

      // ìƒíƒœ ë³€ìˆ˜
      const defaultRules = [
        { targets: ["ìœ ì €", "í ì‹œ", "í ì†Œ"], replace: "{{user}}" },
        { targets: ["ìºë¦­í„°", "í ë‚¨", "í ë…€"], replace: "{{char}}" },
      ];
      let customRules =
        JSON.parse(localStorage.getItem("toast_custom_rules")) || [];

      // ì´ˆê¸°í™”
      function init() {
        // ë‹¤í¬ëª¨ë“œ í™•ì¸
        if (localStorage.getItem("toast_darkmode") === "true") {
          document.body.classList.add("dark");
        }

        // ì €ì¥ëœ í…ìŠ¤íŠ¸ í™•ì¸
        const savedText = localStorage.getItem("toast_input_text");
        if (savedText) {
          inputText.value = savedText;
          convert();
        }

        renderRules();
      }

      // ì •ê·œì‹ ì´ìŠ¤ì¼€ì´í”„
      function escapeRegExp(string) {
        return string.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
      }

      // í…ìŠ¤íŠ¸ ë³€í™˜ í•µì‹¬ ë¡œì§
      function convert() {
        let text = inputText.value;

        // 1. ì»¤ìŠ¤í…€ ë£° ì ìš©
        customRules.forEach((rule) => {
          if (rule.key && rule.val) {
            const regex = new RegExp(escapeRegExp(rule.key), "g");
            text = text.replace(regex, rule.val);
          }
        });

        // 2. ê¸°ë³¸ ë£° ì ìš©
        defaultRules.forEach((rule) => {
          rule.targets.forEach((target) => {
            const regex = new RegExp(escapeRegExp(target), "g");
            text = text.replace(regex, rule.replace);
          });
        });

        outputText.value = text;
        localStorage.setItem("toast_input_text", inputText.value);
      }

      // ì„¤ì •ì°½ ë Œë”ë§
      function renderRules() {
        customRuleContainer.innerHTML = "";
        if (customRules.length === 0) {
          customRuleContainer.innerHTML =
            '<div style="text-align:center; color:#888; padding:10px; font-size:0.9rem;">ì¶”ê°€ëœ ê·œì¹™ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
          return;
        }

        customRules.forEach((rule, idx) => {
          const div = document.createElement("div");
          div.className = "rule-item";
          div.innerHTML = `
                    <input type="text" value="${rule.key}" readonly style="background:var(--btn-bg); color:var(--text-color);">
                    <span style="color:var(--border-color)">â†’</span>
                    <input type="text" value="${rule.val}" readonly style="background:var(--btn-bg); color:var(--text-color); font-weight:bold;">
                    <button onclick="removeRule(${idx})" style="padding:8px; color:#ff6b6b; border:none; background:transparent;">âœ•</button>
                `;
          customRuleContainer.appendChild(div);
        });
      }

      // ê·œì¹™ ì¶”ê°€
      document.getElementById("addRuleBtn").addEventListener("click", () => {
        const key = newKey.value.trim();
        const val = newVal.value.trim();

        if (!key || !val) {
          showToast("âŒ ë‹¨ì–´ì™€ ê²°ê³¼ë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.");
          return;
        }

        customRules.push({ key, val });
        localStorage.setItem("toast_custom_rules", JSON.stringify(customRules));

        newKey.value = "";
        newVal.value = "";
        renderRules();
        convert();
        newKey.focus();
      });

      // ë¹ ë¥¸ ì…ë ¥
      window.fillVal = function (val) {
        newVal.value = val;
        newVal.focus();
      };

      // ê·œì¹™ ì‚­ì œ
      window.removeRule = function (idx) {
        customRules.splice(idx, 1);
        localStorage.setItem("toast_custom_rules", JSON.stringify(customRules));
        renderRules();
        convert();
      };

      // í† ìŠ¤íŠ¸ ì•Œë¦¼
      function showToast(msg) {
        toast.textContent = msg;
        toast.classList.add("show");
        setTimeout(() => {
          toast.classList.remove("show");
        }, 2000);
      }

      // ë³µì‚¬ ê¸°ëŠ¥
      function copyText(text, msg) {
        if (!text) return;
        return navigator.clipboard
          .writeText(text)
          .then(() => showToast(msg))
          .catch(() => {
            // Fallback
            const ta = document.createElement("textarea");
            ta.value = text;
            document.body.appendChild(ta);
            ta.select();
            document.execCommand("copy");
            document.body.removeChild(ta);
            showToast(msg);
          });
      }

      // ë§ì¶¤ë²• ê²€ì‚¬
      spellBtn.addEventListener("click", () => {
        const text = inputText.value;
        if (!text) {
          showToast("âŒ ê²€ì‚¬í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.");
          return;
        }

        // ë³µì‚¬ í›„ ì´ë™
        copyText(text, "âœ… ë‚´ìš© ë³µì‚¬ ì™„ë£Œ! ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”.").then(() => {
          window.open("https://nara-speller.co.kr/speller", "_blank");
        });
      });

      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
      inputText.addEventListener("input", convert);

      document.getElementById("copyInputBtn").addEventListener("click", () => {
        copyText(inputText.value, "âœ… ì›ë³¸ ë‚´ìš©ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
      });

      document.getElementById("copyOutputBtn").addEventListener("click", () => {
        copyText(outputText.value, "âœ… ë³€í™˜ëœ ë‚´ìš©ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
      });

      document.getElementById("clearBtn").addEventListener("click", () => {
        if (confirm("ëª¨ë“  ë‚´ìš©ì„ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ?")) {
          inputText.value = "";
          convert();
        }
      });

      // ì„¤ì •ì°½ ì—´ê¸°/ë‹«ê¸°
      settingBtn.addEventListener("click", () => {
        settingModal.classList.add("open");
        renderRules();
      });

      closeModal.addEventListener("click", () =>
        settingModal.classList.remove("open"),
      );
      settingModal.addEventListener("click", (e) => {
        if (e.target === settingModal) settingModal.classList.remove("open");
      });

      // ë¹µ ì•„ì´ë´í‹°í‹° ë§í¬
      document.getElementById("breadBtn").addEventListener("click", () => {
        window.location.href = "https://toastout.github.io/toast/";
      });

      // ë‹¤í¬ëª¨ë“œ í† ê¸€
      document.getElementById("toggleDarkBtn").addEventListener("click", () => {
        document.body.classList.toggle("dark");
        localStorage.setItem(
          "toast_darkmode",
          document.body.classList.contains("dark"),
        );
      });

      // ì—”í„°í‚¤ë¡œ ê·œì¹™ ì¶”ê°€
      newVal.addEventListener("keypress", (e) => {
        if (e.key === "Enter") document.getElementById("addRuleBtn").click();
      });

      // ì‹œì‘
      init();
    </script>
  </body>
</html>
